#![feature(offset_of_enum)]

use std::cmp::{max, min};
use std::sync::atomic::{AtomicIsize, Ordering};
use xross_core::{XrossClass, xross_class, xross_methods, xross_function, xross_function_dsl};

// --- グローバル・カウンター ---
static SERVICE_COUNT: AtomicIsize = AtomicIsize::new(0);
static UNKNOWN_STRUCT_COUNT: AtomicIsize = AtomicIsize::new(0);
static SERVICE2_COUNT: AtomicIsize = AtomicIsize::new(0);

// Tokio runtime for tests
static RUNTIME: std::sync::LazyLock<tokio::runtime::Runtime> = std::sync::LazyLock::new(|| {
    tokio::runtime::Builder::new_multi_thread()
        .enable_all()
        .build()
        .expect("Failed to create Tokio runtime")
});

#[unsafe(no_mangle)]
pub extern "C" fn xross_example_init_runtime() {
    let _ = *RUNTIME;
}

#[xross_function(package = "standalone")]
pub async fn async_add(a: i32, b: i32) -> i32 {
    tokio::time::sleep(std::time::Duration::from_millis(50)).await;
    a + b
}

#[xross_function(package = "standalone")]
pub async fn async_greet(name: String) -> String {
    tokio::time::sleep(std::time::Duration::from_millis(50)).await;
    format!("Async Hello, {}!", name)
}

// --- UnknownStruct ---
// ... (rest of the file remains similar but I will use replace for the middle part)
